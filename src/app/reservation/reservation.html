<app-navbar></app-navbar>

<div class="reservation-container">
  <div class="content-wrapper">
    <!-- Liste des rendez-vous √† gauche -->
    <div class="appointments-section">
      <h2>Mes rendez-vous</h2>
      
      <!-- Loading state -->
      @if (isLoading()) {
        <div class="loading">
          <p>Chargement des rendez-vous...</p>
        </div>
      }
      
      <!-- Error state -->
      @if (errorMessage() && !isLoading()) {
        <div class="error-message">
          <p>{{ errorMessage() }}</p>
          @if (!isAuthenticated()) {
            <button class="btn-primary" routerLink="/starter">Se connecter</button>
          }
        </div>
      }
      
      <!-- Empty state - Aucun rendez-vous -->
      @if (!isLoading() && !errorMessage() && rendezVousList().length === 0) {
        <div class="no-appointments-message">
          <p>‚úì Aucun rendez-vous</p>
        </div>
      }
      
      <div class="appointments-list">
        <!-- Liste dynamique des rendez-vous avec pagination -->
        @for (rdv of getRendezVousPagines(); track rdv.id) {
          <div class="appointment-card">
            <div class="appointment-header">
              <h3>Dr. {{ rdv.professionnel.prenom }} {{ rdv.professionnel.nom }}</h3>
              <span class="specialty">{{ rdv.professionnel.specialite.nom }}</span>
            </div>
            <div class="appointment-details">
              <div class="detail-item">
                <span class="icon">üìÖ</span>
                <span>{{ formatDate(rdv.date) }}</span>
              </div>
              <div class="detail-item">
                <span class="icon">üïê</span>
                <span>{{ rdv.heure_debut }}</span>
              </div>
              <div class="detail-item">
                <span class="icon">üìç</span>
                <span>{{ rdv.cabinet.nom }}</span>
              </div>
              <div class="detail-item">
                <span class="icon">üè•</span>
                <span>{{ getModeLabel(rdv.mode) }}</span>
              </div>
            </div>
            <div class="appointment-actions">
              <button class="btn-cancel">Annuler</button>
              <button class="btn-modify">Modifier</button>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      @if (rendezVousList().length > parPage) {
        <div class="pagination">
          <button 
            class="pagination-btn" 
            (click)="pagePrecedente()" 
            [disabled]="pageActuelle() === 1"
          >
            Pr√©c√©dent
          </button>
          <span class="pagination-info">
            Page {{ pageActuelle() }} sur {{ getTotalPages() }}
          </span>
          <button 
            class="pagination-btn" 
            (click)="pageSuivante()" 
            [disabled]="pageActuelle() === getTotalPages()"
          >
            Suivant
          </button>
        </div>
      }
    </div>

    <!-- Calendrier √† droite -->
    <div class="calendar-section">
      <h2>Calendrier</h2>
      <div class="calendar">
        <div class="calendar-header">
          <button class="nav-btn" (click)="previousMonth()">‚Äπ</button>
          <h3>{{ getMonthYear() }}</h3>
          <button class="nav-btn" (click)="nextMonth()">‚Ä∫</button>
        </div>
        
        <div class="calendar-grid">
          @for (dayName of daysOfWeek; track dayName) {
            <div class="day-name">{{ dayName }}</div>
          }
          
          @for (dayInfo of calendarDays(); track $index) {
            <div class="day" 
                 [class.empty]="dayInfo.isEmpty"
                 [class.today]="dayInfo.isToday"
                 [class.has-appointment]="dayInfo.hasAppointment">
              {{ dayInfo.day }}
            </div>
          }
        </div>
        
        <div class="calendar-legend">
          <div class="legend-item">
            <span class="legend-dot today-dot"></span>
            <span>Aujourd'hui</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot appointment-dot"></span>
            <span>Rendez-vous</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
