<app-navbar></app-navbar>

<div class="admin-container">
  <div class="header">
    <h1>Administration</h1>
  </div>

  <!-- Onglets -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab() === 'professionnels'"
      (click)="setTab('professionnels')"
    >
      Professionnels ({{ professionnels().length }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab() === 'rendez-vous'"
      (click)="setTab('rendez-vous')"
    >
      Rendez-vous ({{ rendezVous().length }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab() === 'clients'"
      (click)="setTab('clients')"
    >
      Clients ({{ clients().length }})
    </button>
  </div>

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }
  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  <!-- Onglet Professionnels -->
  @if (activeTab() === 'professionnels') {
    <div class="tab-content">
      @if (!isEditingProf()) {
        <div class="table-header">
          <h2>Gestion des Professionnels</h2>
          <button class="btn-add" (click)="newProfessionnel()">+ Nouveau</button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th>Spécialité</th>
                <th>Tarif</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (prof of getProfessionnelsPagines(); track prof.id) {
                <tr>
                  <td>{{ prof.nom }}</td>
                  <td>{{ prof.prenom }}</td>
                  <td>{{ prof.email }}</td>
                  <td>{{ prof.specialite }}</td>
                  <td>{{ prof.tarif_consultation }} €</td>
                  <td><span class="badge" [class.badge-success]="prof.statut_validation === 'VALIDE'">{{ prof.statut_validation }}</span></td>
                  <td class="actions">
                    <button class="btn-edit" (click)="editProfessionnel(prof)">Modifier</button>
                    <button class="btn-delete" (click)="deleteProfessionnel(prof.id!)">Supprimer</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        @if (getTotalPagesProfessionnels() > 1) {
          <div class="pagination">
            <button (click)="prevPageProfessionnels()" [disabled]="pageProfessionnels() === 1">Précédent</button>
            <span>Page {{ pageProfessionnels() }} / {{ getTotalPagesProfessionnels() }}</span>
            <button (click)="nextPageProfessionnels()" [disabled]="pageProfessionnels() === getTotalPagesProfessionnels()">Suivant</button>
          </div>
        }
      } @else {
        <div class="form-card">
          <h2>{{ currentProfessionnel().id ? 'Modifier' : 'Nouveau' }} Professionnel</h2>
          
          <div class="form-grid">
            <div class="form-group">
              <label>Nom</label>
              <input type="text" [(ngModel)]="currentProfessionnel().nom" />
            </div>

            <div class="form-group">
              <label>Prénom</label>
              <input type="text" [(ngModel)]="currentProfessionnel().prenom" />
            </div>

            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="currentProfessionnel().email" />
            </div>

            <div class="form-group">
              <label>Spécialité</label>
              <select [(ngModel)]="currentProfessionnel().specialite">
                <option value="0">Sélectionner</option>
                @for (spec of specialites(); track spec.id) {
                  <option [value]="spec.id">{{ spec.nom }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label>Tarif (€)</label>
              <input type="number" [(ngModel)]="currentProfessionnel().tarif_consultation" />
            </div>

            <div class="form-group">
              <label>Statut</label>
              <select [(ngModel)]="currentProfessionnel().statut_validation">
                <option value="VALIDE">Validé</option>
                <option value="EN_ATTENTE">En attente</option>
                <option value="REFUSE">Refusé</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label>Bio</label>
              <textarea [(ngModel)]="currentProfessionnel().bio" rows="4"></textarea>
            </div>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" [(ngModel)]="currentProfessionnel().accepte_teleconsultation" />
                Accepte téléconsultation
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn-cancel" (click)="cancel()">Annuler</button>
            <button class="btn-save" (click)="saveProfessionnel()">Enregistrer</button>
          </div>
        </div>
      }
    </div>
  }

  <!-- Onglet Rendez-vous -->
  @if (activeTab() === 'rendez-vous') {
    <div class="tab-content">
      <div class="table-header">
        <h2>Gestion des Rendez-vous</h2>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Patient</th>
              <th>Professionnel</th>
              <th>Date</th>
              <th>Heure</th>
              <th>Statut</th>
              <th>Mode</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (rdv of getRendezVousPagines(); track rdv.id) {
              <tr>
                <td>{{ rdv.patient.username }}</td>
                <td>Dr. {{ rdv.professionnel.prenom }} {{ rdv.professionnel.nom }}</td>
                <td>{{ rdv.date }}</td>
                <td>{{ rdv.heure_debut }} - {{ rdv.heure_fin }}</td>
                <td><span class="badge">{{ rdv.statut }}</span></td>
                <td>{{ rdv.mode }}</td>
                <td class="actions">
                  <button class="btn-delete" (click)="deleteRendezVous(rdv.id)">Supprimer</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      @if (getTotalPagesRendezVous() > 1) {
        <div class="pagination">
          <button (click)="prevPageRendezVous()" [disabled]="pageRendezVous() === 1">Précédent</button>
          <span>Page {{ pageRendezVous() }} / {{ getTotalPagesRendezVous() }}</span>
          <button (click)="nextPageRendezVous()" [disabled]="pageRendezVous() === getTotalPagesRendezVous()">Suivant</button>
        </div>
      }
    </div>
  }

  <!-- Onglet Clients -->
  @if (activeTab() === 'clients') {
    <div class="tab-content">
      <div class="table-header">
        <h2>Gestion des Clients</h2>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Nom</th>
              <th>Email</th>
              <th>Type</th>
              <th>Ville</th>
              <th>Téléphone</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (client of getClientsPagines(); track client.id) {
              <tr>
                <td>
                  {{ client.username }}
                  @if (client.is_admin) {
                    <span class="badge badge-admin">Admin</span>
                  }
                </td>
                <td>{{ client.first_name }} {{ client.last_name }}</td>
                <td>{{ client.email }}</td>
                <td><span class="badge">{{ client.type_compte }}</span></td>
                <td>{{ client.ville || '-' }}</td>
                <td>{{ client.telephone || '-' }}</td>
                <td><span class="badge" [class.badge-success]="client.statut === 'actif'">{{ client.statut }}</span></td>
                <td class="actions">
                  @if (!client.is_admin) {
                    <button class="btn-delete" (click)="deleteClient(client.id)">Supprimer</button>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      @if (getTotalPagesClients() > 1) {
        <div class="pagination">
          <button (click)="prevPageClients()" [disabled]="pageClients() === 1">Précédent</button>
          <span>Page {{ pageClients() }} / {{ getTotalPagesClients() }}</span>
          <button (click)="nextPageClients()" [disabled]="pageClients() === getTotalPagesClients()">Suivant</button>
        </div>
      }
    </div>
  }
</div>
